---
interface Props {
  nativeLang?: string;
  targetLang?: string;
}

const { nativeLang = 'en', targetLang } = Astro.props;

// Supported native languages for content
const SUPPORTED_NATIVE_LANGS = ['en', 'es', 'fr'];

const LANGUAGE_INFO: Record<string, { flag: string; nativeName: string }> = {
  en: { flag: 'ðŸ‡¬ðŸ‡§', nativeName: 'English' },
  es: { flag: 'ðŸ‡ªðŸ‡¸', nativeName: 'EspaÃ±ol' },
  fr: { flag: 'ðŸ‡«ðŸ‡·', nativeName: 'FranÃ§ais' },
};

// Build logo href - go to current language articles page if available, otherwise home
const logoHref = nativeLang && targetLang ? `/learn/${nativeLang}/${targetLang}/` : '/learn/';

// Get native language options (exclude target language - can't learn your own language)
const nativeLanguageOptions = SUPPORTED_NATIVE_LANGS
  .filter(code => code !== targetLang && LANGUAGE_INFO[code])
  .map(code => ({ code, ...LANGUAGE_INFO[code] }));

const currentNativeInfo = LANGUAGE_INFO[nativeLang] || LANGUAGE_INFO.en;
---

<nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-lg border-b border-gray-100 shadow-sm">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex items-center justify-between h-14">
      <!-- Left: Native Language Selector + Logo -->
      <div class="flex items-center gap-3">
        {/* Native Language Dropdown */}
        {targetLang && nativeLanguageOptions.length > 1 && (
          <select
            id="nav-native-lang"
            class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700 cursor-pointer border-none outline-none"
            data-target-lang={targetLang}
          >
            {nativeLanguageOptions.map(({ code, flag, nativeName }) => (
              <option value={code} selected={code === nativeLang}>
                {flag} {nativeName}
              </option>
            ))}
          </select>
        )}

        {/* Logo */}
        <a href={logoHref} class="flex items-center gap-2 text-accent font-bold font-header text-lg hover:opacity-80 transition-opacity">
          <img src="/favicon.svg" alt="" class="w-6 h-6" />
          <span class="hidden sm:inline">Love Languages</span>
        </a>
      </div>

      <!-- Right: CTA Button -->
      <a
        href="/"
        class="px-4 py-2 bg-accent text-white font-bold rounded-full hover:bg-accent/90 hover:shadow-md transition-all text-sm"
      >
        Start Learning
      </a>
    </div>
  </div>
</nav>

<script>
  const dropdown = document.getElementById('nav-native-lang') as HTMLSelectElement;
  if (dropdown) {
    const targetLang = dropdown.dataset.targetLang;
    dropdown.addEventListener('change', () => {
      const newNativeLang = dropdown.value;
      window.location.href = `/learn/${newNativeLang}/${targetLang}/`;
    });
  }
</script>
