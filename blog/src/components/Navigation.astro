---
interface Props {
  nativeLang?: string;
  targetLang?: string;
}

const { nativeLang = 'en', targetLang } = Astro.props;

// Supported native languages for content (only languages with article content)
const SUPPORTED_NATIVE_LANGS = ['en', 'es', 'fr', 'de', 'it', 'pt', 'nl', 'pl', 'ru', 'uk', 'tr', 'ro', 'sv', 'no', 'da', 'cs', 'el', 'hu'];

const LANGUAGE_INFO: Record<string, { flag: string; nativeName: string }> = {
  en: { flag: 'ğŸ‡¬ğŸ‡§', nativeName: 'English' },
  es: { flag: 'ğŸ‡ªğŸ‡¸', nativeName: 'EspaÃ±ol' },
  fr: { flag: 'ğŸ‡«ğŸ‡·', nativeName: 'FranÃ§ais' },
  de: { flag: 'ğŸ‡©ğŸ‡ª', nativeName: 'Deutsch' },
  it: { flag: 'ğŸ‡®ğŸ‡¹', nativeName: 'Italiano' },
  pt: { flag: 'ğŸ‡µğŸ‡¹', nativeName: 'PortuguÃªs' },
  nl: { flag: 'ğŸ‡³ğŸ‡±', nativeName: 'Nederlands' },
  pl: { flag: 'ğŸ‡µğŸ‡±', nativeName: 'Polski' },
  ru: { flag: 'ğŸ‡·ğŸ‡º', nativeName: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹' },
  uk: { flag: 'ğŸ‡ºğŸ‡¦', nativeName: 'Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°' },
  tr: { flag: 'ğŸ‡¹ğŸ‡·', nativeName: 'TÃ¼rkÃ§e' },
  ro: { flag: 'ğŸ‡·ğŸ‡´', nativeName: 'RomÃ¢nÄƒ' },
};

// Navigation UI translations
const NAV_TRANSLATIONS: Record<string, { compareApps: string; startLearning: string }> = {
  en: { compareApps: 'Compare Apps', startLearning: 'Start Learning' },
  es: { compareApps: 'Comparar Apps', startLearning: 'Empezar' },
  fr: { compareApps: 'Comparer', startLearning: 'Commencer' },
  de: { compareApps: 'Vergleichen', startLearning: 'Starten' },
  it: { compareApps: 'Confronta', startLearning: 'Inizia' },
  pt: { compareApps: 'Comparar', startLearning: 'ComeÃ§ar' },
  nl: { compareApps: 'Vergelijk', startLearning: 'Start' },
  pl: { compareApps: 'PorÃ³wnaj', startLearning: 'Zacznij' },
  ru: { compareApps: 'Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ', startLearning: 'ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ' },
  uk: { compareApps: 'ĞŸĞ¾Ñ€Ñ–Ğ²Ğ½ÑÑ‚Ğ¸', startLearning: 'ĞŸĞ¾Ñ‡Ğ°Ñ‚Ğ¸' },
  tr: { compareApps: 'KarÅŸÄ±laÅŸtÄ±r', startLearning: 'BaÅŸla' },
  ro: { compareApps: 'ComparÄƒ', startLearning: 'Ãncepe' },
};

const navText = NAV_TRANSLATIONS[nativeLang] || NAV_TRANSLATIONS.en;

// Build logo href - go to current language hub page
const logoHref = `/learn/${nativeLang}/`;

// Get native language options (exclude target language if set - can't learn your own language)
const nativeLanguageOptions = SUPPORTED_NATIVE_LANGS
  .filter(code => (!targetLang || code !== targetLang) && LANGUAGE_INFO[code])
  .map(code => ({ code, ...LANGUAGE_INFO[code] }));

const currentNativeInfo = LANGUAGE_INFO[nativeLang] || LANGUAGE_INFO.en;
---

<nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-lg border-b border-gray-100 shadow-sm">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex items-center justify-between h-14">
      <!-- Left: Native Language Selector + Logo -->
      <div class="flex items-center gap-3">
        {/* Native Language Dropdown - shows when we have multiple language options */}
        {nativeLanguageOptions.length > 1 && (
          <select
            id="nav-native-lang"
            class="px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700 cursor-pointer border-none outline-none"
          >
            {nativeLanguageOptions.map(({ code, flag, nativeName }) => (
              <option value={code} selected={code === nativeLang}>
                {flag} {nativeName}
              </option>
            ))}
          </select>
        )}

        {/* Logo */}
        <a href={logoHref} class="flex items-center gap-2 text-accent font-bold font-header text-lg hover:opacity-80 transition-opacity">
          <img src="/favicon.svg" alt="" class="w-6 h-6" />
          <span class="hidden sm:inline">Love Languages</span>
        </a>
      </div>

      <!-- Right: Compare Dropdown + CTA -->
      <div class="flex items-center gap-4">
        <div class="relative hidden sm:block">
          <select
            id="nav-compare"
            class="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700 cursor-pointer border-none outline-none appearance-none pr-8"
            data-native-lang={nativeLang}
          >
            <option value="" disabled selected>{navText.compareApps}</option>
            <option value="love-languages-vs-duolingo">vs Duolingo</option>
            <option value="love-languages-vs-babbel">vs Babbel</option>
          </select>
          <svg class="absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </div>
        <a
          href="/"
          class="px-4 py-2 bg-accent text-white font-bold rounded-full hover:bg-accent/90 hover:shadow-md transition-all text-sm"
        >
          {navText.startLearning}
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  // Native language selector
  const langDropdown = document.getElementById('nav-native-lang') as HTMLSelectElement;
  if (langDropdown) {
    langDropdown.addEventListener('change', () => {
      window.location.href = `/learn/${langDropdown.value}/`;
    });
  }

  // Compare apps dropdown
  const compareDropdown = document.getElementById('nav-compare') as HTMLSelectElement;
  if (compareDropdown) {
    compareDropdown.addEventListener('change', () => {
      const nativeLang = compareDropdown.dataset.nativeLang || 'en';
      const comparison = compareDropdown.value;
      if (comparison) {
        window.location.href = `/compare/${nativeLang}/${comparison}/`;
      }
    });
  }
</script>
