---
/**
 * NativeLanguageSelector - Simple dropdown to switch native language
 * Navigates to the correct page when changed
 */

interface LanguageInfo {
  flag: string;
  name: string;
  nativeName: string;
}

interface Props {
  currentNativeLang: string;
  targetLang: string;
  languageInfo: Record<string, LanguageInfo>;
  availableNativeLanguages?: string[];
}

// Supported native languages for content (languages with translated articles)
const SUPPORTED_NATIVE_LANGS = ['en', 'es', 'fr', 'de', 'it', 'pt', 'ru', 'pl', 'tr'];

const {
  currentNativeLang,
  targetLang,
  languageInfo,
  availableNativeLanguages = SUPPORTED_NATIVE_LANGS
} = Astro.props;

// Filter to only show available native languages (can't learn your own language)
const nativeLanguageOptions = availableNativeLanguages
  .filter(code => code !== targetLang && languageInfo[code])
  .map(code => ({ code, info: languageInfo[code] }));
---

<div class="native-lang-select inline-flex items-center gap-2">
  <span class="text-sm text-gray-500">Articles in:</span>
  <select
    id="native-lang-dropdown"
    class="native-dropdown px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm font-medium text-gray-700 cursor-pointer border-none outline-none appearance-none pr-8"
    data-target-lang={targetLang}
  >
    {nativeLanguageOptions.map(({ code, info }) => (
      <option value={code} selected={code === currentNativeLang}>
        {info.flag} {info.nativeName}
      </option>
    ))}
  </select>
  <svg class="w-3 h-3 text-gray-400 -ml-6 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
  </svg>
</div>

<script>
  const dropdown = document.getElementById('native-lang-dropdown') as HTMLSelectElement;
  if (dropdown) {
    const targetLang = dropdown.dataset.targetLang;
    dropdown.addEventListener('change', () => {
      const newNativeLang = dropdown.value;
      window.location.href = `/learn/${newNativeLang}/${targetLang}/`;
    });
  }
</script>
