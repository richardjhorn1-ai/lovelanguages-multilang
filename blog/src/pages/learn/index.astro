---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Testimonials from '../../components/Testimonials.astro';
import LeadMagnet from '../../components/LeadMagnet.astro';
import { getCollection } from 'astro:content';

// Language config for flags and names
const LANGUAGE_INFO: Record<string, { flag: string; name: string; nativeName: string }> = {
  en: { flag: 'ğŸ‡¬ğŸ‡§', name: 'English', nativeName: 'English' },
  es: { flag: 'ğŸ‡ªğŸ‡¸', name: 'Spanish', nativeName: 'EspaÃ±ol' },
  fr: { flag: 'ğŸ‡«ğŸ‡·', name: 'French', nativeName: 'FranÃ§ais' },
  it: { flag: 'ğŸ‡®ğŸ‡¹', name: 'Italian', nativeName: 'Italiano' },
  pt: { flag: 'ğŸ‡µğŸ‡¹', name: 'Portuguese', nativeName: 'PortuguÃªs' },
  ro: { flag: 'ğŸ‡·ğŸ‡´', name: 'Romanian', nativeName: 'RomÃ¢nÄƒ' },
  de: { flag: 'ğŸ‡©ğŸ‡ª', name: 'German', nativeName: 'Deutsch' },
  nl: { flag: 'ğŸ‡³ğŸ‡±', name: 'Dutch', nativeName: 'Nederlands' },
  sv: { flag: 'ğŸ‡¸ğŸ‡ª', name: 'Swedish', nativeName: 'Svenska' },
  no: { flag: 'ğŸ‡³ğŸ‡´', name: 'Norwegian', nativeName: 'Norsk' },
  da: { flag: 'ğŸ‡©ğŸ‡°', name: 'Danish', nativeName: 'Dansk' },
  pl: { flag: 'ğŸ‡µğŸ‡±', name: 'Polish', nativeName: 'Polski' },
  cs: { flag: 'ğŸ‡¨ğŸ‡¿', name: 'Czech', nativeName: 'ÄŒeÅ¡tina' },
  ru: { flag: 'ğŸ‡·ğŸ‡º', name: 'Russian', nativeName: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹' },
  uk: { flag: 'ğŸ‡ºğŸ‡¦', name: 'Ukrainian', nativeName: 'Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°' },
  el: { flag: 'ğŸ‡¬ğŸ‡·', name: 'Greek', nativeName: 'Î•Î»Î»Î·Î½Î¹ÎºÎ¬' },
  hu: { flag: 'ğŸ‡­ğŸ‡º', name: 'Hungarian', nativeName: 'Magyar' },
  tr: { flag: 'ğŸ‡¹ğŸ‡·', name: 'Turkish', nativeName: 'TÃ¼rkÃ§e' },
};

// Get all articles
const allArticles = await getCollection('articles');

// Count articles per language
const languageCounts: Record<string, number> = {};
for (const code of Object.keys(LANGUAGE_INFO)) {
  languageCounts[code] = allArticles.filter(a => a.slug.startsWith(`${code}/`)).length;
}

// Sort: languages with articles first, then alphabetically
const sortedLanguages = Object.entries(LANGUAGE_INFO).sort(([codeA], [codeB]) => {
  const countA = languageCounts[codeA] || 0;
  const countB = languageCounts[codeB] || 0;
  if (countA > 0 && countB === 0) return -1;
  if (countB > 0 && countA === 0) return 1;
  return LANGUAGE_INFO[codeA].name.localeCompare(LANGUAGE_INFO[codeB].name);
});

// Get total article count
const totalArticles = allArticles.length;
const languagesWithContent = Object.values(languageCounts).filter(c => c > 0).length;

// JSON-LD for the language hub
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Love Languages - Learn Any Language Together",
  "description": "Free language lessons, vocabulary guides, and cultural tips for couples learning 18 languages together.",
  "url": "https://lovelanguages.xyz/learn",
  "publisher": {
    "@type": "Organization",
    "name": "Love Languages",
    "url": "https://lovelanguages.xyz"
  },
  "numberOfItems": totalArticles
};
---

<BaseLayout
  title="Learn Any Language Together - Free Lessons for Couples"
  description="Free language lessons, vocabulary guides, and cultural tips for couples learning together. 18 languages available including Spanish, French, German, Italian, Polish and more."
>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <!-- Hero Section -->
  <header class="bg-gradient-to-b from-accent/10 to-white">
    <div class="max-w-6xl mx-auto px-4 py-12 md:py-20">
      <div class="text-center max-w-3xl mx-auto">
        <div class="flex justify-center gap-2 mb-6 flex-wrap">
          {['ğŸ‡ªğŸ‡¸', 'ğŸ‡«ğŸ‡·', 'ğŸ‡©ğŸ‡ª', 'ğŸ‡®ğŸ‡¹', 'ğŸ‡µğŸ‡±', 'ğŸ‡µğŸ‡¹', 'ğŸ‡·ğŸ‡º', 'ğŸ‡¬ğŸ‡·'].map(flag => (
            <span class="text-3xl">{flag}</span>
          ))}
        </div>
        <h1 class="text-4xl md:text-5xl font-black font-header text-gray-900 mb-4">
          Learn Any Language Together
        </h1>
        <p class="text-xl text-gray-600 mb-8">
          Free lessons, vocabulary guides, and cultural tips designed for couples learning together.
        </p>
        <div class="flex justify-center gap-6 text-sm text-gray-500">
          <div class="flex items-center gap-2">
            <span class="text-2xl">ğŸ“š</span>
            <span><strong class="text-gray-900">{totalArticles}</strong> Articles</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-2xl">ğŸŒ</span>
            <span><strong class="text-gray-900">18</strong> Languages</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Language Grid -->
  <main class="max-w-6xl mx-auto px-4 py-12">
    <h2 class="text-2xl font-bold font-header text-gray-900 mb-8 text-center">
      Choose Your Language
    </h2>

    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
      {sortedLanguages.map(([code, info]) => {
        const count = languageCounts[code] || 0;
        const hasArticles = count > 0;

        return (
          <a
            href={`/learn/${code}`}
            class={`group relative flex flex-col items-center p-6 rounded-2xl border-2 transition-all ${
              hasArticles
                ? 'border-gray-200 hover:border-accent hover:shadow-lg bg-white'
                : 'border-gray-100 bg-gray-50 hover:border-gray-200'
            }`}
          >
            <span class="text-5xl mb-3 group-hover:scale-110 transition-transform">{info.flag}</span>
            <span class={`font-semibold ${hasArticles ? 'text-gray-900' : 'text-gray-400'}`}>
              {info.name}
            </span>
            <span class="text-xs text-gray-400 mb-2">{info.nativeName}</span>

            {hasArticles ? (
              <span class="text-xs font-medium px-2 py-1 rounded-full bg-accent/10 text-accent">
                {count} {count === 1 ? 'article' : 'articles'}
              </span>
            ) : (
              <span class="text-xs text-gray-300">Coming soon</span>
            )}

            {hasArticles && (
              <div class="absolute inset-0 rounded-2xl ring-2 ring-accent ring-offset-2 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" />
            )}
          </a>
        );
      })}
    </div>
  </main>

  <!-- Popular Languages Section -->
  {languagesWithContent > 0 && (
    <section class="bg-gray-50 py-16">
      <div class="max-w-6xl mx-auto px-4">
        <h2 class="text-2xl font-bold font-header text-gray-900 mb-8 text-center">
          Most Popular Languages
        </h2>

        <div class="grid md:grid-cols-3 gap-6">
          {sortedLanguages
            .filter(([code]) => languageCounts[code] > 0)
            .slice(0, 3)
            .map(([code, info]) => (
              <a
                href={`/learn/${code}`}
                class="bg-white rounded-2xl p-6 border border-gray-200 hover:border-accent hover:shadow-lg transition-all group"
              >
                <div class="flex items-center gap-4 mb-4">
                  <span class="text-5xl">{info.flag}</span>
                  <div>
                    <h3 class="text-xl font-bold text-gray-900 group-hover:text-accent transition-colors">
                      {info.name}
                    </h3>
                    <p class="text-gray-500">{languageCounts[code]} articles</p>
                  </div>
                </div>
                <p class="text-gray-600 text-sm">
                  Learn {info.name} vocabulary, phrases, grammar, and culture with your partner.
                </p>
                <div class="mt-4 text-accent font-medium text-sm flex items-center gap-1 group-hover:gap-2 transition-all">
                  Start Learning
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              </a>
            ))}
        </div>
      </div>
    </section>
  )}

  <!-- Lead Magnet -->
  <section class="max-w-3xl mx-auto px-4 py-8">
    <LeadMagnet />
  </section>

  <!-- Testimonials -->
  <section class="max-w-6xl mx-auto px-4">
    <Testimonials />
  </section>

  <!-- Main CTA -->
  <section class="bg-gradient-to-r from-accent to-pink-500 py-16">
    <div class="max-w-2xl mx-auto px-4 text-center text-white">
      <h2 class="text-3xl font-bold font-header mb-4">
        Ready to Start Learning?
      </h2>
      <p class="text-white/90 mb-8">
        Join couples learning languages together with AI coaching, voice practice, and games.
      </p>
      <a
        href="/"
        class="inline-block bg-white text-accent font-bold px-8 py-4 rounded-full hover:shadow-lg hover:scale-105 transition-all text-lg"
      >
        Start Your Journey
      </a>
      <p class="mt-4 text-white/80 text-sm">
        Join couples learning languages across 30+ countries
      </p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-100 border-t border-gray-200 py-12">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <a href="/" class="inline-flex items-center gap-2 text-2xl font-bold font-header text-accent mb-4">
        <img src="/favicon.svg" alt="" class="w-8 h-8" />
        Love Languages
      </a>
      <p class="text-gray-600 mb-6">Learn any language together with your partner</p>
      <nav class="flex justify-center gap-6 text-sm text-gray-500">
        <a href="/learn/" class="hover:text-accent">Blog</a>
        <a href="/tools" class="hover:text-accent">Tools</a>
        <a href="/terms" class="hover:text-accent">Terms</a>
        <a href="/privacy" class="hover:text-accent">Privacy</a>
      </nav>
    </div>
  </footer>
</BaseLayout>
