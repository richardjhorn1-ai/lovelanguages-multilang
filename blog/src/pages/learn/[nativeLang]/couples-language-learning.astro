---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import LanguageCard from '../../../components/hub/LanguageCard.astro';
import FAQSection from '../../../components/hub/FAQSection.astro';
import { LANGUAGE_HUB_DATA } from '../../../data/language-hub-data';
import { getUITranslations } from '../../../data/ui-translations';
import { getCouplesTranslations } from '../../../data/couples-translations';
import { SUPPORTED_NATIVE_LANGS, getLanguageForDisplay } from '../../../data/language-info';

const { nativeLang } = Astro.params;
const nativeLanguageCode = nativeLang || 'en';

// Redirect invalid languages to English version
if (!SUPPORTED_NATIVE_LANGS.includes(nativeLanguageCode)) {
  return Astro.redirect('/learn/couples-language-learning/');
}

// Get translations
const uiText = getUITranslations(nativeLanguageCode);
const t = getCouplesTranslations(nativeLanguageCode);
const s = t.sections;

// Get top languages sorted by difficulty (easiest first for couples)
const languages = Object.values(LANGUAGE_HUB_DATA)
  .sort((a, b) => a.difficultyRating - b.difficultyRating);

const easiestLanguages = languages.slice(0, 6);

// Hreflang alternates
const hreflangAlternates = SUPPORTED_NATIVE_LANGS
  .filter(lang => lang !== nativeLanguageCode)
  .map(lang => ({
    lang,
    href: `https://www.lovelanguages.io/learn/${lang}/couples-language-learning/`
  }));

const canonicalUrl = `https://www.lovelanguages.io/learn/${nativeLanguageCode}/couples-language-learning/`;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": s.hero.title,
  "description": s.hero.subtitle,
  "url": canonicalUrl,
  "inLanguage": nativeLanguageCode,
  "publisher": {
    "@type": "Organization",
    "name": "Love Languages",
    "url": "https://www.lovelanguages.io"
  }
};
---

<BaseLayout
  title={`${s.hero.title} | Love Languages`}
  description={s.hero.subtitle}
  nativeLang={nativeLanguageCode}
>
  <Fragment slot="head">
    <link rel="canonical" href={canonicalUrl} />
    <link rel="alternate" hreflang={nativeLanguageCode} href={canonicalUrl} />
    <link rel="alternate" hreflang="x-default" href="https://www.lovelanguages.io/learn/en/couples-language-learning/" />
    {hreflangAlternates.map(alt => (
      <link rel="alternate" hreflang={alt.lang} href={alt.href} />
    ))}
  </Fragment>

  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <!-- Hero -->
  <header class="bg-gradient-to-b from-pink-50 to-white">
    <div class="max-w-6xl mx-auto px-4 py-12 md:py-20">
      <div class="text-center max-w-3xl mx-auto">
        <span class="text-6xl mb-4 block">üíë</span>
        <h1 class="text-3xl md:text-5xl font-black font-header text-gray-900 mb-4">
          {s.hero.title}
        </h1>
        <p class="text-lg md:text-xl text-gray-600 mb-8">
          {s.hero.subtitle}
        </p>
        <a
          href={`/learn/${nativeLanguageCode}/`}
          class="inline-flex items-center gap-2 text-[#4ECDC4] hover:underline"
        >
          ‚Üê {uiText.backToHub || 'Back to Language Hub'}
        </a>
      </div>
    </div>
  </header>

  <!-- Why Learn Together -->
  <section class="py-12 bg-white">
    <div class="max-w-4xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-bold font-header text-gray-900 mb-8">
        {s.whyLearnTogether.sectionTitle}
      </h2>

      <div class="grid md:grid-cols-2 gap-6">
        {s.whyLearnTogether.benefits.map(benefit => (
          <div class="p-6 bg-gradient-to-br from-accent/5 to-pink-50 rounded-2xl border border-accent/10">
            <span class="text-3xl mb-3 block">{benefit.emoji}</span>
            <h3 class="font-bold text-gray-900 mb-2">{benefit.title}</h3>
            <p class="text-gray-600">{benefit.description}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Best Languages for Couples -->
  <section class="py-12 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-bold font-header text-gray-900 mb-2">
        {s.bestLanguages.sectionTitle}
      </h2>
      <p class="text-gray-600 mb-8">
        {s.bestLanguages.subtitle}
      </p>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        {easiestLanguages.map(lang => (
          <LanguageCard
            code={lang.code}
            name={lang.name}
            nativeName={lang.nativeName}
            flag={lang.flag}
            speakers={lang.speakers}
            difficultyRating={lang.difficultyRating}
            href={`/learn/${nativeLanguageCode}/${lang.code}/`}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Tips Section -->
  <section class="py-12 bg-white">
    <div class="max-w-4xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-bold font-header text-gray-900 mb-8">
        {s.tips.sectionTitle}
      </h2>

      <div class="space-y-6">
        {s.tips.items.map((tip, i) => (
          <div class="flex gap-4 items-start p-5 bg-gray-50 rounded-xl">
            <span class="w-10 h-10 rounded-full bg-accent text-white flex items-center justify-center font-bold flex-shrink-0">{i + 1}</span>
            <div>
              <h3 class="font-bold text-gray-900 mb-1">{tip.title}</h3>
              <p class="text-gray-600">{tip.description}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Explore All Languages -->
  <section class="py-12 bg-gray-50">
    <div class="max-w-6xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-bold font-header text-gray-900 mb-2 text-center">
        {s.exploreAll.title}
      </h2>
      <p class="text-gray-600 mb-8 text-center">
        {s.exploreAll.subtitle}
      </p>

      <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {languages.map(lang => (
          <LanguageCard
            code={lang.code}
            name={lang.name}
            nativeName={lang.nativeName}
            flag={lang.flag}
            speakers={lang.speakers}
            difficultyRating={lang.difficultyRating}
            href={`/learn/${nativeLanguageCode}/${lang.code}/`}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- FAQs -->
  <FAQSection faqs={s.faqs} />

  <!-- CTA -->
  <section class="bg-gradient-to-r from-accent to-pink-500 py-16">
    <div class="max-w-2xl mx-auto px-4 text-center text-white">
      <h2 class="text-3xl font-bold font-header mb-4">
        {s.cta.title}
      </h2>
      <p class="text-white/90 mb-8">
        {s.cta.subtitle}
      </p>
      <a
        href="/"
        class="inline-block bg-white text-accent font-bold px-8 py-4 rounded-full hover:shadow-lg hover:scale-105 transition-all text-lg"
      >
        {s.cta.button}
      </a>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-100 border-t border-gray-200 py-12">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <a href="/" class="inline-flex items-center gap-2 text-2xl font-bold font-header text-accent mb-4">
        <img src="/favicon.svg" alt="" class="w-8 h-8" />
        Love Languages
      </a>
      <p class="text-gray-600 mb-6">{s.footer.tagline}</p>
      <nav class="flex justify-center gap-6 text-sm text-gray-500">
        <a href={`/learn/${nativeLanguageCode}/`} class="hover:text-accent">{uiText.blog || 'Blog'}</a>
        <a href="/tools" class="hover:text-accent">{uiText.tools || 'Tools'}</a>
        <a href="/terms" class="hover:text-accent">Terms</a>
        <a href="/privacy" class="hover:text-accent">Privacy</a>
      </nav>
    </div>
  </footer>
</BaseLayout>
