---
/**
 * Methodology Index Page
 * URL: /learn/[nativeLang]/couples-language-learning/methodology/
 *
 * Lists all couples methodology articles for a given native language
 */
import BaseLayout from '../../../../../layouts/BaseLayout.astro';
import { createClient } from '@supabase/supabase-js';
import { SUPPORTED_NATIVE_LANGS, getLanguageName } from '../../../../../data/language-info';

const { nativeLang } = Astro.params;

// Validate native language
if (!SUPPORTED_NATIVE_LANGS.includes(nativeLang || '')) {
  return Astro.redirect('/learn/en/couples-language-learning/methodology/');
}

// Fetch articles from Supabase
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || import.meta.env.SUPABASE_URL;
const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY || import.meta.env.SUPABASE_ANON_KEY;

let articles: any[] = [];

try {
  if (supabaseUrl && supabaseKey) {
    const supabase = createClient(supabaseUrl, supabaseKey);

    const { data, error } = await supabase
      .from('blog_articles')
      .select('slug, title, description, read_time, difficulty')
      .eq('native_lang', nativeLang)
      .eq('target_lang', 'all')
      .eq('category', 'couples-methodology')
      .eq('published', true)
      .order('title');

    if (error) {
      console.error('Methodology index Supabase error:', error.message);
    }

    if (data) {
      articles = data;
    }
  }
} catch (err) {
  console.error('Methodology index error:', err);
}

// Hreflang alternates
const hreflangAlternates = SUPPORTED_NATIVE_LANGS
  .filter(lang => lang !== nativeLang)
  .map(lang => ({
    lang,
    href: `https://www.lovelanguages.io/learn/${lang}/couples-language-learning/methodology/`
  }));

const canonicalUrl = `https://www.lovelanguages.io/learn/${nativeLang}/couples-language-learning/methodology/`;

// Page content per language
const pageContent: Record<string, { title: string; subtitle: string; description: string }> = {
  en: {
    title: 'Couples Language Learning Methodology',
    subtitle: 'The science-backed approach to learning your partner\'s language together',
    description: 'Discover our research-based methodology for couples learning languages together. From avoiding common mistakes to AI coaching strategies.'
  },
  es: {
    title: 'MetodologÃ­a de Aprendizaje de Idiomas para Parejas',
    subtitle: 'El enfoque respaldado por la ciencia para aprender el idioma de tu pareja juntos',
    description: 'Descubre nuestra metodologÃ­a basada en investigaciÃ³n para parejas que aprenden idiomas juntas.'
  },
  fr: {
    title: 'MÃ©thodologie d\'Apprentissage des Langues pour Couples',
    subtitle: 'L\'approche scientifique pour apprendre la langue de votre partenaire ensemble',
    description: 'DÃ©couvrez notre mÃ©thodologie basÃ©e sur la recherche pour les couples qui apprennent les langues ensemble.'
  },
  de: {
    title: 'Methodik des Paar-Sprachlernens',
    subtitle: 'Der wissenschaftlich fundierte Ansatz zum gemeinsamen Erlernen der Sprache Ihres Partners',
    description: 'Entdecken Sie unsere forschungsbasierte Methodik fÃ¼r Paare, die gemeinsam Sprachen lernen.'
  },
  it: {
    title: 'Metodologia di Apprendimento Linguistico per Coppie',
    subtitle: 'L\'approccio scientifico per imparare la lingua del partner insieme',
    description: 'Scopri la nostra metodologia basata sulla ricerca per coppie che imparano le lingue insieme.'
  },
  pt: {
    title: 'Metodologia de Aprendizado de Idiomas para Casais',
    subtitle: 'A abordagem cientÃ­fica para aprender o idioma do seu parceiro juntos',
    description: 'Descubra nossa metodologia baseada em pesquisa para casais aprendendo idiomas juntos.'
  },
  pl: {
    title: 'Metodologia Nauki JÄ™zykÃ³w dla Par',
    subtitle: 'Naukowo uzasadnione podejÅ›cie do wspÃ³lnej nauki jÄ™zyka partnera',
    description: 'Odkryj naszÄ… metodologiÄ™ opartÄ… na badaniach dla par uczÄ…cych siÄ™ jÄ™zykÃ³w razem.'
  },
  ru: {
    title: 'ĞœĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ˜Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¯Ğ·Ñ‹ĞºĞ¾Ğ² Ğ´Ğ»Ñ ĞŸĞ°Ñ€',
    subtitle: 'ĞĞ°ÑƒÑ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğº ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ½Ğ¾Ğ¼Ñƒ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ° Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€Ğ°',
    description: 'ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ½Ğ°ÑˆÑƒ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ, Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ Ğ½Ğ° Ğ¸ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑÑ…, Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€, Ğ¸Ğ·ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ñ… ÑĞ·Ñ‹ĞºĞ¸ Ğ²Ğ¼ĞµÑÑ‚Ğµ.'
  },
  uk: {
    title: 'ĞœĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ Ğ’Ğ¸Ğ²Ñ‡ĞµĞ½Ğ½Ñ ĞœĞ¾Ğ² Ğ´Ğ»Ñ ĞŸĞ°Ñ€',
    subtitle: 'ĞĞ°ÑƒĞºĞ¾Ğ²Ğ¸Ğ¹ Ğ¿Ñ–Ğ´Ñ…Ñ–Ğ´ Ğ´Ğ¾ ÑĞ¿Ñ–Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¸Ğ²Ñ‡ĞµĞ½Ğ½Ñ Ğ¼Ğ¾Ğ²Ğ¸ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°',
    description: 'Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ğ¹Ñ‚Ğµ Ğ½Ğ°ÑˆÑƒ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ, Ğ·Ğ°ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ñƒ Ğ½Ğ° Ğ´Ğ¾ÑĞ»Ñ–Ğ´Ğ¶ĞµĞ½Ğ½ÑÑ…, Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€, ÑĞºÑ– Ğ²Ğ¸Ğ²Ñ‡Ğ°ÑÑ‚ÑŒ Ğ¼Ğ¾Ğ²Ğ¸ Ñ€Ğ°Ğ·Ğ¾Ğ¼.'
  },
  nl: {
    title: 'Methodologie voor Taal Leren voor Koppels',
    subtitle: 'De wetenschappelijk onderbouwde aanpak om samen de taal van je partner te leren',
    description: 'Ontdek onze op onderzoek gebaseerde methodologie voor koppels die samen talen leren.'
  },
  sv: {
    title: 'Metodik fÃ¶r Pars SprÃ¥kinlÃ¤rning',
    subtitle: 'Det vetenskapligt grundade tillvÃ¤gagÃ¥ngssÃ¤ttet fÃ¶r att lÃ¤ra sig partnerns sprÃ¥k tillsammans',
    description: 'UpptÃ¤ck vÃ¥r forskningsbaserade metodik fÃ¶r par som lÃ¤r sig sprÃ¥k tillsammans.'
  },
  no: {
    title: 'Metodikk for ParsprÃ¥klÃ¦ring',
    subtitle: 'Den vitenskapelig baserte tilnÃ¦rmingen til Ã¥ lÃ¦re partnerens sprÃ¥k sammen',
    description: 'Oppdag vÃ¥r forskningsbaserte metodikk for par som lÃ¦rer sprÃ¥k sammen.'
  },
  da: {
    title: 'Metode til ParsprogindlÃ¦ring',
    subtitle: 'Den videnskabeligt baserede tilgang til at lÃ¦re din partners sprog sammen',
    description: 'Opdag vores forskningsbaserede metode for par, der lÃ¦rer sprog sammen.'
  },
  cs: {
    title: 'Metodika UÄenÃ­ JazykÅ¯ pro PÃ¡ry',
    subtitle: 'VÄ›decky podloÅ¾enÃ½ pÅ™Ã­stup ke spoleÄnÃ©mu uÄenÃ­ se jazyku partnera',
    description: 'Objevte naÅ¡i metodiku zaloÅ¾enou na vÃ½zkumu pro pÃ¡ry, kterÃ© se uÄÃ­ jazyky spoleÄnÄ›.'
  },
  ro: {
    title: 'Metodologia ÃnvÄƒÈ›Äƒrii Limbilor pentru Cupluri',
    subtitle: 'Abordarea bazatÄƒ pe È™tiinÈ›Äƒ pentru a Ã®nvÄƒÈ›a limba partenerului Ã®mpreunÄƒ',
    description: 'DescoperÄƒ metodologia noastrÄƒ bazatÄƒ pe cercetare pentru cupluri care Ã®nvaÈ›Äƒ limbi Ã®mpreunÄƒ.'
  },
  el: {
    title: 'ÎœÎµÎ¸Î¿Î´Î¿Î»Î¿Î³Î¯Î± Î•ÎºÎ¼Î¬Î¸Î·ÏƒÎ·Ï‚ Î“Î»Ï‰ÏƒÏƒÏÎ½ Î³Î¹Î± Î–ÎµÏ…Î³Î¬ÏÎ¹Î±',
    subtitle: 'Î— ÎµÏ€Î¹ÏƒÏ„Î·Î¼Î¿Î½Î¹ÎºÎ¬ Ï„ÎµÎºÎ¼Î·ÏÎ¹Ï‰Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· Î³Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï„Î· Î³Î»ÏÏƒÏƒÎ± Ï„Î¿Ï… ÏƒÏ…Î½Ï„ÏÏŒÏ†Î¿Ï… ÏƒÎ±Ï‚ Î¼Î±Î¶Î¯',
    description: 'Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ Ï„Î· Î¼ÎµÎ¸Î¿Î´Î¿Î»Î¿Î³Î¯Î± Î¼Î±Ï‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î·Î½ Î­ÏÎµÏ…Î½Î± Î³Î¹Î± Î¶ÎµÏ…Î³Î¬ÏÎ¹Î± Ï€Î¿Ï… Î¼Î±Î¸Î±Î¯Î½Î¿Ï…Î½ Î³Î»ÏÏƒÏƒÎµÏ‚ Î¼Î±Î¶Î¯.'
  },
  hu: {
    title: 'PÃ¡ros NyelvtanulÃ¡si MÃ³dszertan',
    subtitle: 'A tudomÃ¡nyosan megalapozott megkÃ¶zelÃ­tÃ©s a partner nyelvÃ©nek kÃ¶zÃ¶s tanulÃ¡sÃ¡hoz',
    description: 'Fedezd fel kutatÃ¡salapÃº mÃ³dszertanunkat pÃ¡roknak, akik egyÃ¼tt tanulnak nyelveket.'
  },
  tr: {
    title: 'Ã‡iftler Ä°Ã§in Dil Ã–ÄŸrenimi Metodolojisi',
    subtitle: 'Partnerinizin dilini birlikte Ã¶ÄŸrenmek iÃ§in bilime dayalÄ± yaklaÅŸÄ±m',
    description: 'Birlikte dil Ã¶ÄŸrenen Ã§iftler iÃ§in araÅŸtÄ±rmaya dayalÄ± metodolojimizi keÅŸfedin.'
  }
};

const content = pageContent[nativeLang || 'en'] || pageContent.en;

// Breadcrumb labels per language
const breadcrumbLabels: Record<string, { home: string; couples: string; methodology: string }> = {
  en: { home: 'Learn', couples: 'Couples Language Learning', methodology: 'Methodology' },
  es: { home: 'Aprender', couples: 'Aprendizaje en Pareja', methodology: 'MetodologÃ­a' },
  fr: { home: 'Apprendre', couples: 'Apprentissage en Couple', methodology: 'MÃ©thodologie' },
  de: { home: 'Lernen', couples: 'Paar-Sprachlernen', methodology: 'Methodik' },
  it: { home: 'Impara', couples: 'Apprendimento di Coppia', methodology: 'Metodologia' },
  pt: { home: 'Aprender', couples: 'Aprendizado para Casais', methodology: 'Metodologia' },
  pl: { home: 'Nauka', couples: 'Nauka dla Par', methodology: 'Metodologia' },
  ru: { home: 'Ğ£Ñ‡Ğ¸Ñ‚ÑŒ', couples: 'ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ĞŸĞ°Ñ€', methodology: 'ĞœĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ' },
  uk: { home: 'Ğ’Ñ‡Ğ¸Ñ‚Ğ¸', couples: 'ĞĞ°Ğ²Ñ‡Ğ°Ğ½Ğ½Ñ Ğ´Ğ»Ñ ĞŸĞ°Ñ€', methodology: 'ĞœĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ' },
  nl: { home: 'Leren', couples: 'Taal Leren voor Koppels', methodology: 'Methodologie' },
  sv: { home: 'LÃ¤r dig', couples: 'Pars SprÃ¥kinlÃ¤rning', methodology: 'Metodik' },
  no: { home: 'LÃ¦r', couples: 'ParsprÃ¥klÃ¦ring', methodology: 'Metodikk' },
  da: { home: 'LÃ¦r', couples: 'ParsprogindlÃ¦ring', methodology: 'Metode' },
  cs: { home: 'UÄit se', couples: 'UÄenÃ­ pro PÃ¡ry', methodology: 'Metodika' },
  ro: { home: 'ÃnvaÈ›Äƒ', couples: 'ÃnvÄƒÈ›are pentru Cupluri', methodology: 'Metodologie' },
  el: { home: 'ÎœÎ¬Î¸Îµ', couples: 'Î•ÎºÎ¼Î¬Î¸Î·ÏƒÎ· Î³Î¹Î± Î–ÎµÏ…Î³Î¬ÏÎ¹Î±', methodology: 'ÎœÎµÎ¸Î¿Î´Î¿Î»Î¿Î³Î¯Î±' },
  hu: { home: 'Tanulj', couples: 'PÃ¡ros NyelvtanulÃ¡s', methodology: 'MÃ³dszertan' },
  tr: { home: 'Ã–ÄŸren', couples: 'Ã‡iftler Ä°Ã§in Dil Ã–ÄŸrenimi', methodology: 'Metodoloji' }
};

const labels = breadcrumbLabels[nativeLang || 'en'] || breadcrumbLabels.en;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": content.title,
  "description": content.description,
  "url": canonicalUrl,
  "inLanguage": nativeLang,
  "publisher": {
    "@type": "Organization",
    "name": "Love Languages",
    "url": "https://www.lovelanguages.io/"
  }
};
---

<BaseLayout
  title={`${content.title} | Love Languages`}
  description={content.description}
  canonical={canonicalUrl}
  nativeLang={nativeLang}
>
  <Fragment slot="head">
    <link rel="alternate" hreflang={nativeLang} href={canonicalUrl} />
    <link rel="alternate" hreflang="x-default" href="https://www.lovelanguages.io/learn/en/couples-language-learning/methodology/" />
    {hreflangAlternates.map(alt => (
      <link rel="alternate" hreflang={alt.lang} href={alt.href} />
    ))}
  </Fragment>

  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <div class="bg-white min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-8">

      <!-- Breadcrumbs -->
      <nav class="text-sm text-gray-500 mb-6">
        <ol class="flex items-center space-x-2">
          <li>
            <a href={`/learn/${nativeLang}/`} class="hover:text-pink-600">{labels.home}</a>
          </li>
          <li class="text-gray-400">/</li>
          <li>
            <a href={`/learn/${nativeLang}/couples-language-learning/`} class="hover:text-pink-600">{labels.couples}</a>
          </li>
          <li class="text-gray-400">/</li>
          <li class="text-gray-700 font-medium">{labels.methodology}</li>
        </ol>
      </nav>

      <!-- Hero -->
      <header class="text-center mb-12">
        <span class="text-5xl mb-4 block">ğŸ“š</span>
        <h1 class="text-3xl md:text-4xl font-black font-header text-gray-900 mb-4">
          {content.title}
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-6">
          {content.subtitle}
        </p>
        <a
          href={`/learn/${nativeLang}/couples-language-learning/`}
          class="inline-flex items-center gap-2 text-[#FF6B6B] hover:underline font-medium"
        >
          â† {labels.couples}
        </a>
      </header>

      <!-- Article List -->
      {articles.length > 0 ? (
        <div class="grid gap-6">
          {articles.map((article) => (
            <a
              href={`/learn/${nativeLang}/couples-language-learning/methodology/${article.slug}/`}
              class="block p-6 bg-white border border-gray-200 rounded-xl hover:border-pink-300 hover:shadow-lg transition-all"
            >
              <h2 class="text-xl font-bold text-gray-900 mb-2">{article.title}</h2>
              {article.description && (
                <p class="text-gray-600 mb-3">{article.description}</p>
              )}
              <div class="flex items-center gap-4 text-sm text-gray-500">
                {article.read_time && (
                  <span>ğŸ“– {article.read_time} min</span>
                )}
                {article.difficulty && (
                  <span class="px-2 py-1 bg-pink-100 text-pink-700 rounded-full text-xs">
                    {article.difficulty}
                  </span>
                )}
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-12 text-gray-500">
          <p>No methodology articles available yet.</p>
        </div>
      )}

      <!-- CTA -->
      <div class="mt-12 p-6 bg-gradient-to-r from-pink-500 to-red-500 rounded-2xl text-white text-center">
        <h3 class="text-xl font-bold mb-2">Ready to start learning together?</h3>
        <p class="mb-4 opacity-90">Apply these methods with Love Languages</p>
        <a
          href="https://www.lovelanguages.io/signup"
          class="inline-block px-6 py-3 bg-white text-pink-600 font-bold rounded-full hover:bg-pink-50 transition-colors"
        >
          Get Started Free â†’
        </a>
      </div>

    </div>
  </div>
</BaseLayout>
