---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import FAQSection from '../../../../components/hub/FAQSection.astro';
import ArticlesGrid from '../../../../components/hub/ArticlesGrid.astro';
import FamilyHubLink from '../../../../components/hub/FamilyHubLink.astro';
import { LANGUAGE_HUB_DATA, type LanguageHubData } from '../../../../data/language-hub-data';
import { getCollection } from 'astro:content';

/**
 * Language Hub Page - Redesigned for better article discoverability
 *
 * Structure:
 * 1. Compact hero with stats inline
 * 2. Family hub link
 * 3. ARTICLES FIRST - immediately visible
 * 4. Two-column layout: Phrases + Why Learn | Grammar + Culture
 * 5. Compact common mistakes
 * 6. Couples CTA + FAQ
 */

// Generate static paths for all languages
export async function getStaticPaths() {
  const paths = [];

  for (const [code, data] of Object.entries(LANGUAGE_HUB_DATA)) {
    // Use lowercase language name as slug (e.g., "polish", "spanish")
    const slug = data.name.toLowerCase();
    paths.push({
      params: { lang: slug },
      props: { langCode: code, langData: data }
    });
  }

  return paths;
}

interface Props {
  langCode: string;
  langData: LanguageHubData;
}

const { langCode, langData } = Astro.props;

// Get article counts for this language (across all native languages)
const allArticles = await getCollection('articles');
const articleCount = allArticles.filter(a =>
  a.slug.includes(`/${langCode}/`)
).length;

// Find the "I love you" phrase for couples section
const lovePhrase = langData.essentialPhrases.find(p =>
  p.translation.toLowerCase().includes('love')
);

// JSON-LD for the hub page
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": `Learn ${langData.name} - Complete Guide`,
  "description": `Everything you need to start learning ${langData.name}. Free lessons, phrases, grammar tips, and cultural insights for ${langData.speakers} speakers worldwide.`,
  "url": `https://lovelanguages.xyz/learn/language/${langData.name.toLowerCase()}/`,
  "inLanguage": "en",
  "publisher": {
    "@type": "Organization",
    "name": "Love Languages",
    "url": "https://lovelanguages.xyz"
  },
  "about": {
    "@type": "Language",
    "name": langData.name,
    "alternateName": langData.nativeName
  }
};
---

<BaseLayout
  title={`Learn ${langData.name}: Complete Guide for English Speakers | Love Languages`}
  description={`Everything you need to start learning ${langData.name}. Essential phrases, grammar tips, cultural insights, and learning resources. ${langData.speakers} speakers worldwide.`}
  nativeLang="en"
>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <!-- Compact Hero - Inline stats -->
  <header class="relative overflow-hidden" style="background: linear-gradient(135deg, #FFF0F3 0%, #fdfcfd 50%, #E7F5FF 100%);">
    <div class="max-w-6xl mx-auto px-4 py-8 md:py-12">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
        <div class="flex items-center gap-4">
          <span class="text-5xl md:text-6xl">{langData.flag}</span>
          <div>
            <h1 class="text-2xl md:text-4xl font-black font-header text-[#292F36]">
              Learn {langData.name}
            </h1>
            <p class="text-gray-600 text-sm md:text-base">Complete Guide for English Speakers</p>
          </div>
        </div>

        <div class="flex gap-4 md:gap-6 text-sm">
          <div class="text-center px-3 py-2 bg-white/80 rounded-xl">
            <div class="font-bold text-[#292F36]">{langData.speakers}</div>
            <div class="text-gray-500 text-xs">Speakers</div>
          </div>
          <div class="text-center px-3 py-2 bg-white/80 rounded-xl">
            <div class="font-bold text-[#292F36]">{langData.fsiHours}h</div>
            <div class="text-gray-500 text-xs">To Fluency</div>
          </div>
          <div class="text-center px-3 py-2 bg-white/80 rounded-xl">
            <div class="font-bold text-[#FF6B6B]">{'â˜…'.repeat(langData.difficultyRating)}{'â˜†'.repeat(5 - langData.difficultyRating)}</div>
            <div class="text-gray-500 text-xs">Difficulty</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Family Hub Cross-Link -->
  <FamilyHubLink
    languageName={langData.name}
    familyGroup={langData.familyGroup}
  />

  <!-- ARTICLES FIRST - Immediately after hero -->
  <ArticlesGrid
    langCode={langCode}
    langName={langData.name}
    nativeLang="en"
    maxPerCategory={4}
  />

  <!-- Two-Column Reference Section: Phrases + Why Learn | Grammar + Culture -->
  <section class="py-10 bg-gray-50">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid lg:grid-cols-2 gap-6">
        <!-- Left Column: Essential Phrases -->
        <div class="space-y-6">
          <div class="bg-white rounded-2xl p-5 border border-gray-200">
            <h2 class="text-lg font-bold font-header text-[#292F36] mb-4 flex items-center gap-2">
              <span class="text-xl">ğŸ’¬</span> Essential Phrases
            </h2>
            <div class="grid grid-cols-1 gap-2">
              {langData.essentialPhrases.slice(0, 6).map(phrase => (
                <div class="p-3 bg-gray-50 rounded-lg border border-gray-100 hover:border-[#FF6B6B]/30 transition-colors">
                  <div class="flex justify-between items-start gap-2">
                    <div>
                      <span class="font-bold text-[#292F36] text-sm">{phrase.phrase}</span>
                      <span class="text-[#FF6B6B] text-xs ml-2">/{phrase.pronunciation}/</span>
                    </div>
                  </div>
                  <div class="text-gray-600 text-xs mt-1">{phrase.translation}</div>
                </div>
              ))}
            </div>
            <a href={`/learn/en/${langCode}/`} class="mt-4 inline-flex items-center gap-1 text-sm text-[#FF6B6B] font-medium hover:underline">
              See all phrases <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </a>
          </div>

          <!-- Why Learn (compact) -->
          <div class="bg-white rounded-2xl p-5 border border-gray-200">
            <h2 class="text-lg font-bold font-header text-[#292F36] mb-3 flex items-center gap-2">
              <span class="text-xl">ğŸ¯</span> Why Learn {langData.name}?
            </h2>
            <ul class="space-y-2">
              {langData.whyLearn.slice(0, 3).map(reason => (
                <li class="flex gap-2 text-sm text-gray-700">
                  <span class="text-[#4ECDC4] flex-shrink-0">âœ“</span>
                  <span class="line-clamp-2">{reason}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>

        <!-- Right Column: Grammar + Culture -->
        <div class="space-y-6">
          <!-- Grammar Overview (compact) -->
          <div class="bg-white rounded-2xl p-5 border border-gray-200">
            <h2 class="text-lg font-bold font-header text-[#292F36] mb-3 flex items-center gap-2">
              <span class="text-xl">ğŸ“</span> Grammar Highlights
            </h2>
            <ul class="space-y-2">
              {langData.grammarHighlights.slice(0, 4).map(highlight => (
                <li class="flex gap-2 text-sm text-gray-700">
                  <span class="text-[#FF6B6B] flex-shrink-0">â€¢</span>
                  <span class="line-clamp-2">{highlight}</span>
                </li>
              ))}
            </ul>
          </div>

          <!-- Culture Tips (compact) -->
          <div class="bg-white rounded-2xl p-5 border border-gray-200">
            <h2 class="text-lg font-bold font-header text-[#292F36] mb-3 flex items-center gap-2">
              <span class="text-xl">{langData.flag}</span> Cultural Tips
            </h2>
            <ul class="space-y-2">
              {langData.culturalTips.slice(0, 3).map(tip => (
                <li class="flex gap-2 text-sm text-gray-700">
                  <span class="text-[#FFE66D] flex-shrink-0">ğŸ’¡</span>
                  <span class="line-clamp-2">{tip}</span>
                </li>
              ))}
            </ul>
          </div>

          <!-- Common Mistakes (compact) -->
          <div class="bg-white rounded-2xl p-5 border border-gray-200">
            <h2 class="text-lg font-bold font-header text-[#292F36] mb-3 flex items-center gap-2">
              <span class="text-xl">âš ï¸</span> Common Mistakes
            </h2>
            <ul class="space-y-2">
              {langData.commonMistakes.slice(0, 3).map(item => (
                <li class="text-sm">
                  <span class="font-medium text-gray-900">{item.mistake}</span>
                  <span class="text-gray-600 block text-xs mt-0.5 line-clamp-2">{item.explanation}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Couples CTA (compact) -->
  <section class="py-10" style="background: linear-gradient(135deg, #FFF0F3 0%, #E7F5FF 100%);">
    <div class="max-w-4xl mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center gap-6 text-center md:text-left">
        <span class="text-5xl">ğŸ’•</span>
        <div class="flex-1">
          <h2 class="text-xl md:text-2xl font-bold font-header text-[#292F36] mb-2">
            Learn {langData.name} Together
          </h2>
          <p class="text-gray-600 text-sm">{langData.couplesTip}</p>
          {lovePhrase && (
            <p class="mt-2 text-[#FF6B6B] font-bold">
              "{lovePhrase.phrase}" â€” {lovePhrase.translation}
            </p>
          )}
        </div>
        <a
          href={`/learn/language/${langData.name.toLowerCase()}/for-couples/`}
          class="inline-flex items-center gap-2 px-6 py-3 rounded-full font-bold text-white transition-all hover:scale-105 hover:shadow-lg flex-shrink-0"
          style="background: linear-gradient(135deg, #FF6B6B, #FF8E8E);"
        >
          For Couples <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Native Language Options -->
  <section class="py-12 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4">
      <h2 class="text-2xl md:text-3xl font-bold font-header text-gray-900 mb-2 text-center">
        Start Learning {langData.name}
      </h2>
      <p class="text-gray-600 mb-8 text-center">
        Choose your native language to see lessons in your language.
      </p>

      <div class="grid md:grid-cols-3 gap-4 max-w-2xl mx-auto">
        <a
          href={`/learn/en/${langCode}/`}
          class="flex items-center gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 hover:border-accent hover:shadow-lg transition-all group"
        >
          <span class="text-3xl">ğŸ‡¬ğŸ‡§</span>
          <div>
            <div class="font-bold text-gray-900 group-hover:text-accent transition-colors">English</div>
            <div class="text-sm text-gray-500">I speak English</div>
          </div>
        </a>
        <a
          href={`/learn/es/${langCode}/`}
          class="flex items-center gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 hover:border-accent hover:shadow-lg transition-all group"
        >
          <span class="text-3xl">ğŸ‡ªğŸ‡¸</span>
          <div>
            <div class="font-bold text-gray-900 group-hover:text-accent transition-colors">EspaÃ±ol</div>
            <div class="text-sm text-gray-500">Hablo espaÃ±ol</div>
          </div>
        </a>
        <a
          href={`/learn/fr/${langCode}/`}
          class="flex items-center gap-3 p-4 bg-white rounded-xl border-2 border-gray-200 hover:border-accent hover:shadow-lg transition-all group"
        >
          <span class="text-3xl">ğŸ‡«ğŸ‡·</span>
          <div>
            <div class="font-bold text-gray-900 group-hover:text-accent transition-colors">FranÃ§ais</div>
            <div class="text-sm text-gray-500">Je parle franÃ§ais</div>
          </div>
        </a>
      </div>

      {articleCount > 0 && (
        <p class="text-center text-gray-500 mt-6">
          <span class="font-semibold text-accent">{articleCount}</span> articles available
        </p>
      )}
    </div>
  </section>

  <FAQSection faqs={langData.faqs} />

  <!-- Main CTA -->
  <section class="bg-gradient-to-r from-accent to-pink-500 py-16">
    <div class="max-w-2xl mx-auto px-4 text-center text-white">
      <h2 class="text-3xl font-bold font-header mb-4">
        Ready to Start Learning {langData.name}?
      </h2>
      <p class="text-white/90 mb-8">
        Join couples learning {langData.name} together with AI coaching, voice practice, and games.
      </p>
      <a
        href="/"
        class="inline-block bg-white text-accent font-bold px-8 py-4 rounded-full hover:shadow-lg hover:scale-105 transition-all text-lg"
      >
        Start Your Journey
      </a>
      <p class="mt-4 text-white/80 text-sm">
        Join couples learning languages across 30+ countries
      </p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-100 border-t border-gray-200 py-12">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <a href="/" class="inline-flex items-center gap-2 text-2xl font-bold font-header text-accent mb-4">
        <img src="/favicon.svg" alt="" class="w-8 h-8" />
        Love Languages
      </a>
      <p class="text-gray-600 mb-6">Learn any language together with your partner</p>
      <nav class="flex justify-center gap-6 text-sm text-gray-500">
        <a href="/learn/" class="hover:text-accent">Blog</a>
        <a href="/tools" class="hover:text-accent">Tools</a>
        <a href="/terms" class="hover:text-accent">Terms</a>
        <a href="/privacy" class="hover:text-accent">Privacy</a>
      </nav>
    </div>
  </footer>
</BaseLayout>
